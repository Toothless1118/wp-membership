!function(a){a(document).ready(function(){function b(){var b=this;this.init=function(){this.initEvents()},this.initEvents=function(){a("#op-experiment-stats").on("click",".op-stats-experiment-details-trigger",this.showExperimentDetails),a("#op-stats-edit-page-experiment-container").on("click",".op-stats-experiment-details-trigger",this.showExperimentDetails)},this.showExperimentDetails=function(c){var d=a(this).attr("data-experiment-id"),e=wp.template("op-stats-experiment-details");return b.getExperiment(d).then(function(c){OptimizePress.disable_alert=!0,a.fancybox(a.extend({},OptimizePress.fancybox_defaults,{minWidth:800,minHeight:500,content:e({experiment:c.data.experiment})}));b.initBarChart("#op-experiment-variations-bar",c.data.stats);b.getExperimentStats(d,"conversions").then(function(c){var e=b.initLineChart("#op-experiment-variations-line",c.data),f=b.initDateRangePicker("#op-stats-daterange");f.bind("datepicker-closed",function(c){var f=a("#op-stats-daterange").val().split(" - "),g=a("#op-stats-stat").val();b.getExperimentStats(d,g,f[0],f[1]).then(function(a){e.destroy(),e=b.initLineChart("#op-experiment-variations-line",a.data)})}),a(window).trigger("resize"),a("#op-stats-stat").on("change",function(c){var f=a("#op-stats-daterange").val().split(" - "),g=a("#op-stats-stat").val();b.getExperimentStats(d,g,f[0],f[1]).then(function(a){e.destroy(),e=b.initLineChart("#op-experiment-variations-line",a.data)})})})}),!1},this.getExperiment=function(b){return a.ajax({url:OptimizePress.ajaxurl+"?action=op-stats-get-experiment",type:"GET",data:{experiment_id:b},dataType:"json"})},this.getExperimentStats=function(b,c,d,e){return a.ajax({url:OptimizePress.ajaxurl+"?action=op-stats-get-experiment-stats",type:"GET",data:{experiment_id:b,start_date:d,end_date:e,stat:c},dataType:"json"})},this.initBarChart=function(b,c){return new Chart(a(b).get(0).getContext("2d"),{type:"bar",data:{labels:c.labels,datasets:[{label:"Views",backgroundColor:OpChartOptions.colors.light[0],borderColor:OpChartOptions.colors.dark[0],borderWidth:2,data:c.views,lineTension:0},{label:"Unique",backgroundColor:OpChartOptions.colors.light[1],borderColor:OpChartOptions.colors.dark[1],borderWidth:2,data:c.unique,lineTension:0},{label:"Conversions",backgroundColor:OpChartOptions.colors.light[2],borderColor:OpChartOptions.colors.dark[2],borderWidth:2,data:c.conversions,lineTension:0}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})},this.initLineChart=function(b,c){return new Chart(a(b).get(0).getContext("2d"),{type:"line",data:c,options:{animation:!1}})},this.initDateRangePicker=function(b){return a(b).dateRangePicker({separator:" - ",autoClose:!0,showShortcuts:!0,shortcuts:{"prev-days":[7,30],"next-days":null,next:null,prev:["week","month"]}})}}var c=new b;c.init()})}(opjq);