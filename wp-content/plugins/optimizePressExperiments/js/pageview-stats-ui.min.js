!function(a){a(document).ready(function(){function b(){var b=this,c=20;this.init=function(){this.initEvents(),this.initListFilter()},this.initEvents=function(){a("#op-stats-pageviews").on("click",".op-stats-pageviews-page-details",this.showPageDetails),a(".op-stats-pageviews-container").on("click",".first-page, .prev-page, .next-page, .last-page",this.paginate)},this.initListFilter=function(){var c=this.initDateRangePicker("#op-stats-list-daterange");c.bind("datepicker-closed",function(c,d){var e=a(c.currentTarget).val().split(" - ");b.showPagesStats(e[0],e[1],0)})},this.paginate=function(d){var e=a("#op-stats-list-daterange").val().split(" - "),f=parseInt(a(d.currentTarget).attr("data-page"))*c-c;return b.showPagesStats(e[0],e[1],f),!1},this.showPagesStats=function(d,e,f){var g=a("#op-stats-pageviews tbody"),h=parseInt((c+f)/c);g.find("tr").remove(),a(".tablenav").remove(),b.getStats(d,e,f).then(function(b){if(!1===b.success){var d=wp.template("op-stats-page-list-no-data");g.append(d())}else{var e=wp.template("op-stats-page-list-row"),f=parseInt(Math.ceil(b.data.total/c));if(a.each(b.data.items,function(a,b){g.append(e(b))}),b.data.total>c){var i=wp.template("op-stats-page-list-pagination");g.parent().after(i({currentPage:h,totalPages:f}))}}})},this.initDateRangePicker=function(b){return a(b).dateRangePicker({separator:" - ",autoClose:!0,showShortcuts:!0,shortcuts:{"prev-days":[7,30],"next-days":null,next:null,prev:["week","month"]}})},this.showPageDetails=function(c){var d=a(this).attr("data-page-id"),e=wp.template("op-stats-page-details");return b.getPageStats(d).then(function(c){if(c.success===!1)return void alert("No data for current time period.");OptimizePress.disable_alert=!0,a.fancybox(a.extend({},OptimizePress.fancybox_defaults,{minWidth:800,minHeight:500,content:e({form_title:"Stats for: "+c.data.page.title,page_id:d,views:c.data.stats.sum.views,unique:c.data.stats.sum.unique,conversions:c.data.stats.sum.conversions,conversion_rate:c.data.stats.sum.conversion_rate})}));var f=b.initLineChart("#page_views",c.data.stats),g=b.initDateRangePicker("#op-stats-daterange");g.bind("datepicker-closed",function(c,d){var e=a(c.currentTarget).val().split(" - "),g=a(c.currentTarget).attr("data-page-id");b.getPageStats(g,e[0],e[1]).then(function(c){a("#op-stats-page-sum-views").html(c.data.stats.sum.views),a("#op-stats-page-sum-unique").html(c.data.stats.sum.unique),a("#op-stats-page-sum-conversions").html(c.data.stats.sum.conversions),a("#op-stats-page-sum-conversion-rate").html(c.data.stats.sum.conversion_rate+"%"),f.destroy(),f=b.initLineChart("#page_views",c.data.stats)})})}),!1},this.initLineChart=function(b,c){return new Chart(a(b).get(0).getContext("2d"),{type:"line",data:{labels:c.labels,datasets:[{label:"Views",backgroundColor:OpChartOptions.colors.light[0],borderColor:OpChartOptions.colors.dark[0],data:c.views,lineTension:0},{label:"Unique",backgroundColor:OpChartOptions.colors.light[1],borderColor:OpChartOptions.colors.dark[1],data:c.unique,lineTension:0},{label:"Conversions",backgroundColor:OpChartOptions.colors.light[2],borderColor:OpChartOptions.colors.dark[2],data:c.conversions,lineTension:0}]},options:{animation:!1}})},this.getPageStats=function(b,c,d){return a.ajax({url:OptimizePress.ajaxurl+"?action=op-stats-get-page",type:"GET",data:{page_id:b,start_date:c,end_date:d},dataType:"json"})},this.getStats=function(b,d,e,f){return a.ajax({url:OptimizePress.ajaxurl+"?action=op-stats-get-pages",type:"GET",data:{start_date:b,end_date:d,offset:e||0,limit:f||c},dataType:"json"})}}var c=new b;c.init()})}(opjq);