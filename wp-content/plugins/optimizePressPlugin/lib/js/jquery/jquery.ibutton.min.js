/*!
 * iButton jQuery Plug-in
 *
 * Copyright 2011 Giva, Inc. (http://www.givainc.com/labs/)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * 	http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Date: 2011-07-26
 * Rev:  1.0.03
 */
!function(a){a.iButton={version:"1.0.03",setDefaults:function(b){a.extend(d,b)}},a.fn.iButton=function(b){var d="string"==typeof arguments[0]&&arguments[0],e=d&&Array.prototype.slice.call(arguments,1)||arguments,f=0==this.length?null:a.data(this[0],"iButton");if(f&&d&&this.length){if("object"==d.toLowerCase())return f;if(f[d]){var g;return this.each(function(b){var c=a.data(this,"iButton")[d].apply(f,e);if(0==b&&c){if(!c.jquery)return g=c,!1;g=a([]).add(c)}else c&&c.jquery&&(g=g.add(c))}),g||this}return this}return this.each(function(){new c(this,b)})};var b=0;a.browser.iphone=navigator.userAgent.toLowerCase().indexOf("iphone")>-1;var c=function(c,g){var h=this,i=a(c),j=++b,k=!1,l={},m={dragging:!1,clicked:null},n={position:null,offset:null,time:null},g=a.extend({},d,g,a.metadata?i.metadata():{}),o=g.labelOn==e&&g.labelOff==f,p=":checkbox, :radio";if(!i.is(p))return i.find(p).iButton(g);if(!a.data(i[0],"iButton")){a.data(i[0],"iButton",h),"auto"==g.resizeHandle&&(g.resizeHandle=!o),"auto"==g.resizeContainer&&(g.resizeContainer=!o),this.toggle=function(a){var b=arguments.length>0?a:!i[0].checked;i.attr("checked",b).trigger("change")},this.disable=function(b){var c=arguments.length>0?b:!k;k=c,i.attr("disabled",c),q[c?"addClass":"removeClass"](g.classDisabled),a.isFunction(g.disable)&&g.disable.apply(h,[k,i,g])},this.repaint=function(){x()},this.destroy=function(){a([i[0],q[0]]).unbind(".iButton"),a(document).unbind(".iButton_"+j),q.after(i).remove(),a.data(i[0],"iButton",null),a.isFunction(g.destroy)&&g.destroy.apply(h,[i,g])},i.wrap('<div class="'+a.trim(g.classContainer+" "+g.className)+'" />').after('<div class="'+g.classHandle+'"><div class="'+g.classHandleRight+'"><div class="'+g.classHandleMiddle+'" /></div></div><div class="'+g.classLabelOff+'"><span><label>'+g.labelOff+'</label></span></div><div class="'+g.classLabelOn+'"><span><label>'+g.labelOn+'</label></span></div><div class="'+g.classPaddingLeft+'"></div><div class="'+g.classPaddingRight+'"></div>');var q=i.parent(),r=i.siblings("."+g.classHandle),s=i.siblings("."+g.classLabelOff),t=s.children("span"),u=i.siblings("."+g.classLabelOn),v=u.children("span");(g.resizeHandle||g.resizeContainer)&&(l.onspan=v.outerWidth(),l.offspan=t.outerWidth()),g.resizeHandle?(l.handle=Math.min(l.onspan,l.offspan),r.css("width",l.handle)):l.handle=r.width(),g.resizeContainer?(l.container=Math.max(l.onspan,l.offspan)+l.handle+20,q.css("width",l.container),s.css("width",l.container-5)):l.container=q.width();var w=l.container-l.handle-6,x=function(a){var b=i[0].checked,c=b?w:0,a=arguments.length>0?arguments[0]:!0;a&&g.enableFx?(r.stop().animate({left:c},g.duration,g.easing),u.stop().animate({width:c+4},g.duration,g.easing),v.stop().animate({marginLeft:c-w},g.duration,g.easing),t.stop().animate({marginRight:-c},g.duration,g.easing)):(r.css("left",c),u.css("width",c+4),v.css("marginLeft",c-w),t.css("marginRight",-c))};x(!1);var y=function(a){return a.pageX||(a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:0)};q.bind("mousedown.iButton touchstart.iButton",function(b){return a(b.target).is(p)||k||!g.allowRadioUncheck&&i.is(":radio:checked")?void 0:(b.preventDefault(),m.clicked=r,n.position=y(b),n.offset=n.position-(parseInt(r.css("left"),10)||0),n.time=(new Date).getTime(),!1)}),g.enableDrag&&a(document).bind("mousemove.iButton_"+j+" touchmove.iButton_"+j,function(a){if(m.clicked==r){a.preventDefault();var b=y(a);b!=n.offset&&(m.dragging=!0,q.addClass(g.classHandleActive));var c=Math.min(1,Math.max(0,(b-n.offset)/w));return r.css("left",c*w),u.css("width",c*w+4),t.css("marginRight",-c*w),v.css("marginLeft",-(1-c)*w),!1}}),a(document).on("mouseup.iButton_"+j+" touchend.iButton_"+j,".ibutton-container",function(b){if(m.clicked!=r)return!1;b.preventDefault();var c=!0;if(!m.dragging||(new Date).getTime()-n.time<g.clickOffset){var d=i[0].checked;i.attr("checked",!d),a.isFunction(g.click)&&g.click.apply(h,[!d,i,g])}else{var e=y(b),f=(e-n.offset)/w,d=f>=.5;i[0].checked==d&&(c=!1),i.attr("checked",d)}return q.removeClass(g.classHandleActive),m.clicked=null,m.dragging=null,c?i.trigger("change"):x(),!1}),i.bind("change.iButton",function(){if(x(),i.is(":radio")){var b=i[0],c=a(b.form?b.form[b.name]:":radio[name="+b.name+"]");c.filter(":not(:checked)").iButton("repaint")}a.isFunction(g.change)&&g.change.apply(h,[i,g])}).bind("focus.iButton",function(){q.addClass(g.classFocus)}).bind("blur.iButton",function(){q.removeClass(g.classFocus)}),a.isFunction(g.click)&&i.bind("click.iButton",function(){g.click.apply(h,[i[0].checked,i,g])}),i.is(":disabled")&&this.disable(!0),a.browser.msie&&(q.find("*").andSelf().attr("unselectable","on"),i.bind("click.iButton",function(){i.triggerHandler("change.iButton")})),a.isFunction(g.init)&&g.init.apply(h,[i,g])}},d={duration:200,easing:"swing",labelOn:"ON",labelOff:"OFF",resizeHandle:"auto",resizeContainer:"auto",enableDrag:!0,enableFx:!0,allowRadioUncheck:!1,clickOffset:120,className:"",classContainer:"ibutton-container",classDisabled:"ibutton-disabled",classFocus:"ibutton-focus",classLabelOn:"ibutton-label-on",classLabelOff:"ibutton-label-off",classHandle:"ibutton-handle",classHandleMiddle:"ibutton-handle-middle",classHandleRight:"ibutton-handle-right",classHandleActive:"ibutton-active-handle",classPaddingLeft:"ibutton-padding-left",classPaddingRight:"ibutton-padding-right",init:null,change:null,click:null,disable:null,destroy:null},e=d.labelOn,f=d.labelOff}(opjq);