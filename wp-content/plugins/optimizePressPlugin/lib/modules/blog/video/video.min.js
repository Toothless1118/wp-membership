!function(a){function b(a,b,c,d){var e={},f=c/a,g=d/b;return e=c>=a?{thumb_w:a,thumb_h:b}:d>0&&d>f*b?{thumb_w:c,thumb_h:Math.ceil(f*b)}:{thumb_w:Math.ceil(g*a),thumb_h:d}}a(document).ready(function(){a(".module-video .video-url").each(function(){new c(this)})});var c=function(c){var d=this,e=a(c),f=e.closest("div");e.data("preview",f.find(".video-preview")).data("hidden_elems",f.find(".hidden-inputs")).change(function(){var b=a(this),c=b.val(),e=c.replace(/https?:\/\/(www.)?/,""),f=b.data("preview");f.html("").fadeIn("fast");try{if(e.indexOf("youtube.com")>-1)d.add_youtube(c,e.split("/")[1].split("v=")[1].split("&")[0]);else if(e.indexOf("youtu.be")>-1)d.add_youtube(c,e.split("/")[1]);else{for(var g=[[/^vimeo.com\/[0-9]+/,"/",1],[/^vimeo.com\/channels\/[\d\w]+#[0-9]+/,"#",1],[/vimeo.com\/groups\/[\d\w]+\/videos\/[0-9]+/,"/",4]],h=!1,i=0;3>i;i++)if(e.match(g[i][0])){h=!0,d.add_vimeo(c,e.split(g[i][1])[g[i][2]]);break}h===!1&&f.fadeOut("fast")}}catch(j){f.fadeOut("fast")}}),this.add_vimeo=function(c,e){a.ajax({url:"http://vimeo.com/api/v2/video/"+e+".json",dataType:"jsonp",success:function(c){var f={image:c[0].thumbnail_large,embed:"http://player.vimeo.com/video/"+e,width:c[0].width,height:c[0].height};a.extend(f,b(c[0].width,c[0].height,400,220)),d.set_preview(f.image,f.thumb_w,f.thumb_h),d.update_fields(f)}})},this.add_youtube=function(c,e){var f={image:"http://i2.ytimg.com/vi/"+e+"/hqdefault.jpg",embed:"http://www.youtube.com/embed/"+e+"?wmode=opaque",width:"640",height:"390"};a.extend(f,b(640,390,400,220)),d.set_preview(f.image,f.thumb_w,f.thumb_h),d.update_fields(f)},this.set_preview=function(b,c,e){var f=new Image;f.src=b,f.complete?d.set_real_image(f,c,e):a(f).load(function(){d.set_real_image(f,c,e)})},this.set_real_image=function(a,b,c){e.data("preview").html('<img src="'+a.src+'" alt="" border="0" height="'+c+'" width="'+b+'" />')},this.update_fields=function(b){var c=e.data("hidden_elems");a.each(b,function(a,b){c.find(".video-"+a).val(b)})}}}(opjq);